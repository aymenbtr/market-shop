<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dz-Market</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ... Previous styles remain the same ... */
        .product-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s;
        }

        .product-card:hover {
            transform: translateY(-2px);
        }

        .product-price {
            color: #059669;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .delete-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #EF4444;
            color: white;
            padding: 0.25rem;
            border-radius: 9999px;
            z-index: 10;
            display: none;
        }

        .product-card:hover .delete-btn {
            display: block;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- ... Previous HTML remains the same until productsGrid ... -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="productsGrid">
            <!-- Products will be dynamically inserted here -->
        </div>
    </main>
    <!-- ... Rest of the previous HTML ... -->

    <script>
        // Initial products data
        const initialProducts = [
            {
                id: 1,
                name: "Premium Headphones",
                price: 14999.99,
                description: "High-quality wireless headphones with noise cancellation. Experience crystal-clear audio with deep bass and comfortable ear cups for extended listening sessions.",
                images: ["/api/placeholder/300/300", "/api/placeholder/300/300"]
            },
            {
                id: 2,
                name: "Smartwatch",
                price: 29999.99,
                description: "Feature-rich smartwatch with health tracking. Monitor your fitness goals, receive notifications, and track your sleep patterns with this elegant and durable smartwatch.",
                images: ["/api/placeholder/300/300", "/api/placeholder/300/300"]
            }
        ];

        // State management
        let state = {
            products: [],
            selectedProduct: null,
            isAdmin: false,
            showAdminButton: false
        };

        // Initialize products
        function initializeProducts() {
            const savedProducts = localStorage.getItem('marketplaceProducts');
            if (savedProducts) {
                state.products = JSON.parse(savedProducts);
            } else {
                state.products = initialProducts;
                saveProducts();
            }
        }

        // Render products grid
        function renderProducts() {
            const grid = document.getElementById('productsGrid');
            grid.innerHTML = ''; // Clear existing products

            state.products.forEach(product => {
                const productCard = createProductCard(product);
                grid.appendChild(productCard);
            });
        }

        // Create product card element
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card relative group';
            
            // Create delete button if admin
            if (state.isAdmin) {
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
                deleteBtn.onclick = () => handleDeleteProduct(product.id);
                card.appendChild(deleteBtn);
            }

            card.innerHTML += `
                <div class="relative">
                    <div id="gallery-${product.id}"></div>
                    <button onclick="handlePreviewClick(${JSON.stringify(product).replace(/"/g, '&quot;')})" 
                            class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-opacity">
                        <i class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                    </button>
                </div>
                <div class="p-4">
                    <h2 class="text-xl font-semibold mb-2">${product.name}</h2>
                    <p class="text-gray-600 mb-4 line-clamp-2">${product.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="product-price">${formatPrice(product.price)}</span>
                        <button onclick="handleBuyClick(${JSON.stringify(product).replace(/"/g, '&quot;')})"
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center">
                            <i class="fas fa-shopping-cart mr-2"></i>
                            Buy Now
                        </button>
                    </div>
                </div>
            `;

            // Initialize image gallery for this product
            setTimeout(() => {
                createImageGallery(product.images, `gallery-${product.id}`);
            }, 0);

            return card;
        }

        // Check admin status
        function checkAdminStatus() {
            const adminToken = localStorage.getItem('adminToken');
            state.isAdmin = adminToken === ADMIN_CREDENTIALS.token;
            
            // Update admin controls
            const adminControls = document.getElementById('adminControls');
            if (state.isAdmin) {
                adminControls.innerHTML = `
                    <button onclick="showAddProductModal()" 
                            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center">
                        <i class="fas fa-plus mr-2"></i>
                        Add New Product
                    </button>
                    <button onclick="handleLogout()" 
                            class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Logout
                    </button>
                `;
            }
        }

        // Handle admin logout
        function handleLogout() {
            localStorage.removeItem('adminToken');
            location.reload();
        }

        // Handle delete product
        function handleDeleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                state.products = state.products.filter(p => p.id !== productId);
                saveProducts();
                renderProducts();
                showToast('Product deleted successfully!');
            }
        }

        // Save products to localStorage
        function saveProducts() {
            localStorage.setItem('marketplaceProducts', JSON.stringify(state.products));
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initializeProducts();
            checkAdminStatus();
            renderProducts();
            setupScrollPrompt();

            // Setup admin keyboard shortcut
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.shiftKey && e.altKey && e.key === 'A') {
                    state.showAdminButton = true;
                    checkAdminStatus();
                }
            });
        });

        // ... Rest of the previous JavaScript code ...
    </script>
</body>
</html>